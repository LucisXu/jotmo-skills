# Skill：DB 变更（Mongo/MySQL v0.2）

## 强制：三段式
1) 兼容读写上线：新增字段/索引不影响旧逻辑；读时默认值；必要时双写
2) 回填：分批、幂等、可暂停、可重试；失败可观测（日志+指标）
3) 收敛：旧数据占比极低后再考虑收紧/废弃（通常可不做）

## Mongo 要点
- 新字段允许缺失；读取时兜底
- 索引围绕查询模式设计，避免"为了索引而索引"
- 回填：游标分批 + 断点续跑；必须可重复执行

## MySQL 要点
- add column 必须有默认值策略（或允许 null + 读时兜底）
- 索引变更考虑锁与写放大（必要时分步）

## MR 必须写清楚（否则不允许合并）
- 三段式状态（已做哪一步、下一步计划）
- 索引命中说明（对应查询模式）
- 回滚后旧版本读新数据是否不崩
- L2+ 灰度开关与观测指标
